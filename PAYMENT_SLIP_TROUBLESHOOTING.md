# ğŸ” à¸›à¸±à¸à¸«à¸²: à¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹„à¸¡à¹ˆà¸‚à¸¶à¹‰à¸™à¹ƒà¸™ Admin - à¸„à¸³à¹à¸™à¸°à¸™à¸³à¹à¸à¹‰à¹„à¸‚

## ğŸš¨ à¸›à¸±à¸à¸«à¸²à¸«à¸¥à¸±à¸

à¸šà¸²à¸‡à¸„à¸£à¸±à¹‰à¸‡à¸­à¸±à¸à¸ªà¸¥à¸´à¸›à¹„à¸¡à¹ˆà¹„à¸› à¹€à¸Šà¹‡à¸„à¹ƒà¸™ Admin à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸›à¸›à¸£à¸²à¸à¸

---

## ğŸ” à¸ªà¸²à¹€à¸«à¸•à¸¸à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰

### 1. âŒ Firebase Storage à¹„à¸¡à¹ˆà¹„à¸”à¹‰ initialize
- `.env.local` à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸² Firebase Storage
- Connection error à¸à¸±à¸š Firebase

### 2. âŒ Upload à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¹à¸•à¹ˆà¸¢à¸±à¸‡à¸ªà¹ˆà¸‡ Order
- Code à¸¡à¸µ fallback à¹ƒà¸Šà¹‰ "mock://storage" URL
- URL à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™ real URL à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰

### 3. âŒ Firestore à¹„à¸”à¹‰à¸£à¸±à¸š URL à¹à¸•à¹ˆà¹€à¸›à¹‡à¸™ Mock URL
- Admin à¹€à¸«à¹‡à¸™ Order à¹à¸•à¹ˆà¸ªà¸¥à¸´à¸›à¹à¸ªà¸”à¸‡à¹€à¸›à¹‡à¸™ Error

### 4. âŒ Network Error à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸­à¸±à¸à¹‚à¸«à¸¥à¸”
- Browser à¸›à¸´à¸”, refresh, à¸«à¸£à¸·à¸­ disconnect
- à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡à¹€à¸ªà¸£à¹‡à¸ˆ

### 5. âŒ File à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚
- à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸£à¸¹à¸›à¸ à¸²à¸ (JPG, PNG, WebP)
- à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸à¹ˆà¹€à¸à¸´à¸™ 5MB
- Format à¹„à¸¡à¹ˆ support

---

## âœ… à¸§à¸´à¸˜à¸µà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š

### Step 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Console Log
à¹€à¸¡à¸·à¹ˆà¸­à¸à¸” "à¸¢à¸·à¸™à¸¢à¸±à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­":

**à¸–à¹‰à¸²à¹€à¸«à¹‡à¸™:**
```
âœ… Slip uploaded to Firebase Storage: https://...
```
â†’ â­ à¸ªà¸¥à¸´à¸›à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ

**à¸–à¹‰à¸²à¹€à¸«à¹‡à¸™:**
```
âš ï¸ Upload failed, using preview URL instead: ...
mock://storage/payment-slips/...
```
â†’ âŒ à¸ªà¸¥à¸´à¸›à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¹ƒà¸Šà¹‰ fallback URL à¹à¸—à¸™

### Step 2: à¹€à¸Šà¹‡à¸„à¹ƒà¸™ Firestore
1. Firebase Console â†’ Firestore Database
2. orders collection
3. à¹€à¸›à¸´à¸” Order à¸¥à¹ˆà¸²à¸ªà¸¸à¸”
4. à¸”à¸¹à¸„à¹ˆà¸² `paymentSlipUrl`:
   - à¸–à¹‰à¸²à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ `https://` â†’ âœ… à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
   - à¸–à¹‰à¸²à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ `mock://` â†’ âŒ à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§
   - à¸–à¹‰à¸²à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ `data:image` â†’ ğŸŸ¡ Preview URL (à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§)

### Step 3: à¹€à¸Šà¹‡à¸„ Firebase Storage
1. Firebase Console â†’ Storage
2. à¸”à¸¹à¸§à¹ˆà¸² folder `payment-slips` à¸¡à¸µ files à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
3. à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡ = à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§à¹ƒà¸™à¸­à¸±à¸à¹‚à¸«à¸¥à¸”

---

## ğŸ› ï¸ à¸§à¸´à¸˜à¸µà¹à¸à¹‰à¹„à¸‚

### Fix 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š .env.local

```
à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² .env.local à¸¡à¸µ:
VITE_FIREBASE_STORAGE_BUCKET=perfume-shop-82ac7.firebasestorage.app
```

à¸–à¹‰à¸²à¹€à¸ªà¸µà¸¢ â†’ à¸­à¸±à¸à¹€à¸”à¸• `.env.local` à¹ƒà¸«à¸¡à¹ˆ

### Fix 2: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Storage Rules

Firebase Console â†’ Storage â†’ Rules

à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™:
```javascript
match /payment-slips/{allPaths=**} {
  allow read: if request.auth != null;
  allow write: if true;  // â† à¸­à¸™à¸¸à¸à¸²à¸•à¸´à¹ƒà¸«à¹‰à¸—à¸¸à¸à¸„à¸™à¹€à¸‚à¸µà¸¢à¸™
}
```

à¸–à¹‰à¸²à¹€à¸ªà¸µà¸¢ â†’ à¸­à¸±à¸à¹€à¸”à¸•à¹ƒà¸«à¸¡à¹ˆ:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /payment-slips/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if true;
      allow delete: if request.auth != null;
    }
  }
}
```

### Fix 3: à¸¥à¹‰à¸²à¸‡ Cache à¹à¸¥à¸° LocalStorage

```javascript
// à¹„à¸›à¸—à¸µà¹ˆ Browser Console (F12 â†’ Console):
localStorage.clear();
location.reload();
```

### Fix 4: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¸™à¸²à¸”à¹„à¸Ÿà¸¥à¹Œ

**à¸ªà¸¥à¸´à¸› à¸•à¹‰à¸­à¸‡:**
- âœ… JPG, PNG, WebP
- âœ… à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 5MB
- âœ… à¸„à¸§à¸²à¸¡à¸Šà¸±à¸” 300x600px à¸‚à¸¶à¹‰à¸™à¹„à¸›

**à¸–à¹‰à¸²:**
- âŒ BMP, GIF, TIFF â†’ à¸ˆà¸° reject
- âŒ > 5MB â†’ à¸ˆà¸° reject
- âŒ Corrupted file â†’ à¸ˆà¸° reject

### Fix 5: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Network

- âœ… Internet connection à¹à¸™à¹ˆà¸™
- âœ… à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ VPN à¸—à¸µà¹ˆà¸–à¸¹à¸ block
- âœ… Firewall à¹„à¸¡à¹ˆ block Firebase

---

## ğŸ”§ à¸—à¸µà¸¡à¸² Order à¹„à¸› à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸›

### à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸ 1: à¹ƒà¸«à¹‰ Customer à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¹ƒà¸«à¸¡à¹ˆ
```
Admin Dashboard â†’ Orders â†’ View Order
â†’ à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸› â†’ à¸•à¸´à¸”à¸•à¹ˆà¸­ Customer à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¹ƒà¸«à¸¡à¹ˆ
```

### à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸ 2: Admin à¹€à¸¥à¸·à¸­à¸ Accept à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸›
```
Admin Dashboard â†’ Orders â†’ Order Details
â†’ à¸„à¸¥à¸´à¸ âœ… à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸ªà¸¥à¸´à¸› (à¸–à¹‰à¸²à¹€à¸Šà¸·à¹ˆà¸­à¸–à¸·à¸­)
```

### à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸ 3: à¸›à¸à¸´à¹€à¸ªà¸˜ Order à¸™à¸±à¹‰à¸™
```
Admin Dashboard â†’ Orders â†’ Order Details
â†’ à¸„à¸¥à¸´à¸ âŒ à¸›à¸à¸´à¹€à¸ªà¸˜à¸ªà¸¥à¸´à¸› â†’ à¹ƒà¸«à¹‰à¹€à¸«à¸•à¸¸à¸œà¸¥
```

---

## ğŸ“Š Firestore paymentSlipUrl Values

| URL Type | à¸„à¹ˆà¸² | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|----------|-----|---------|
| Real URL | `https://firebasestorage.googleapis.com/v0/b/...` | âœ… à¸ªà¸³à¹€à¸£à¹‡à¸ˆ |
| Preview | `data:image/jpeg;base64,...` | ğŸŸ¡ à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ |
| Mock | `mock://storage/payment-slips/...` | âŒ à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ |

---

## ğŸ” Debug Checklist

à¹€à¸¡à¸·à¹ˆà¸­à¸ªà¸¥à¸´à¸›à¹„à¸¡à¹ˆà¸‚à¸¶à¹‰à¸™:

- [ ] à¹€à¸›à¸´à¸” Browser Console (F12)
- [ ] à¸”à¸¹ logs à¸•à¸­à¸™ upload:
  - âœ… "Slip uploaded to Firebase Storage"?
  - âŒ "Upload failed, using preview URL"?
- [ ] à¹„à¸›à¸—à¸µà¹ˆ Firebase Console â†’ Firestore
- [ ] à¸”à¸¹ `paymentSlipUrl` à¸‚à¸­à¸‡ Order:
  - `https://...` â†’ âœ… OK
  - `mock://...` â†’ âŒ Failed
- [ ] à¹„à¸›à¸—à¸µà¹ˆ Storage â†’ payment-slips folder
- [ ] à¸”à¸¹à¸§à¹ˆà¸²à¸¡à¸µ files?
- [ ] Check Storage Rules à¸–à¸¹à¸?
- [ ] Check .env.local à¸–à¸¹à¸?

---

## ğŸš€ Best Practices

### à¹€à¸¡à¸·à¹ˆà¸­ Upload à¸ªà¸¥à¸´à¸›:
1. âœ… à¹ƒà¸Šà¹‰ JPG à¸«à¸£à¸·à¸­ PNG
2. âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¸™à¸²à¸” (< 5MB)
3. âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸±à¸à¸à¸²à¸“ (full bars)
4. âœ… à¹„à¸¡à¹ˆà¸›à¸´à¸” browser à¸•à¸­à¸™à¸­à¸±à¸à¹‚à¸«à¸¥à¸”
5. âœ… à¸£à¸­à¹ƒà¸«à¹‰à¹€à¸ªà¸£à¹‡à¸ˆ (à¸­à¸¢à¹ˆà¸²à¸£à¸µà¹€à¸‹à¹‡à¸•)

### à¹€à¸¡à¸·à¹ˆà¸­ Error:
1. âœ… à¸­à¹ˆà¸²à¸™ error message à¹ƒà¸«à¹‰à¸”à¸µ
2. âœ… à¸¥à¸­à¸‡à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡
3. âœ… à¸¥à¸­à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹„à¸Ÿà¸¥à¹Œ
4. âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Internet
5. âœ… à¸¥à¹‰à¸²à¸‡ cache

---

## ğŸ“ à¸•à¸´à¸”à¸•à¹ˆà¸­ Support

à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹à¸à¹‰à¹„à¸¡à¹ˆà¹„à¸”à¹‰:

1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Browser Console logs
2. à¸ªà¹ˆà¸‡à¸ à¸²à¸ Order à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸›
3. à¸ªà¹ˆà¸‡ `.env.local` à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š (à¸‹à¹ˆà¸­à¸™ keys)
4. à¸ªà¹ˆà¸‡ Firebase Storage Rules

---

**Last Updated**: November 28, 2025
**Priority**: ğŸ”´ High - Payment slip is critical
